<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Paint (UI fixed)</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="app">
    <header>
      <div class="header-content">
        <div id="systems" class="row">
        <div class="toolbar-group" data-group="file" role="group" aria-label="ファイル">
          <div class="toolbar-group-label">ファイル</div>
          <div class="toolbar-group-body">
            <div class="toolbar-subgroup" role="group" aria-label="復元と新規">
              <button id="restoreBtn" style="display: none">前回復元</button>
              <button id="newDoc">新規</button>
              <button id="open">開く</button><input id="fileInput" type="file" accept="image/*" />
            </div>
            <div class="toolbar-subgroup" role="group" aria-label="保存">
              <button id="savePNG">保存 PNG</button>
              <button id="saveJPG">保存 JPEG</button>
              <button id="saveWEBP">保存 WebP</button>
            </div>
          </div>
        </div>

        <div class="toolbar-group" data-group="edit" role="group" aria-label="編集">
          <div class="toolbar-group-label">編集</div>
          <div class="toolbar-group-body">
            <div class="toolbar-subgroup" role="group" aria-label="履歴">
              <button id="undo">Undo</button>
              <button id="redo">Redo</button>
            </div>
            <div class="toolbar-subgroup" role="group" aria-label="クリップボード">
              <button id="copyBtn" title="Ctrl+C">コピー</button>
              <button id="cutBtn" title="Ctrl+X">カット</button>
              <button id="pasteBtn" title="Ctrl+V">ペースト</button>
            </div>
            <div class="toolbar-subgroup selection-scope" role="group" aria-label="選択対象">
              <span class="toolbar-subgroup-label">選択対象</span>
              <button type="button" class="scope-btn" data-scope="canvas">キャンバス</button>
              <button type="button" class="scope-btn active" data-scope="layer">レイヤー</button>
            </div>
            <div class="toolbar-subgroup" role="group" aria-label="選択操作">
              <button id="cropSelection">選択範囲トリミング</button>
              <button id="affineSelectionH">選択ミラー(水平)</button>
              <button id="affineSelectionV">選択ミラー(垂直)</button>
            </div>
            <div class="toolbar-subgroup" role="group" aria-label="調整">
              <button id="adjustBtn">調整</button>
            </div>
          </div>
        </div>

        <div class="toolbar-group" data-group="canvas" role="group" aria-label="キャンバス">
          <div class="toolbar-group-label">キャンバス</div>
          <div class="toolbar-group-body">
            <div class="toolbar-subgroup" role="group" aria-label="キャンバス管理">
              <button id="clearAll">全レイヤークリア</button>
              <button id="resizeCanvas">サイズ変更</button>
            </div>
            <div class="toolbar-subgroup" role="group" aria-label="不可逆変換">
              <button id="flipCanvasH">キャンバス鏡像(水平)</button>
              <button id="flipCanvasV">キャンバス鏡像(垂直)</button>
            </div>
          </div>
        </div>

        <div class="toolbar-group" data-group="layer" role="group" aria-label="レイヤー">
          <div class="toolbar-group-label">レイヤー</div>
          <div class="toolbar-group-body">
            <div class="toolbar-subgroup" role="group" aria-label="レイヤー操作">
              <button id="addLayerBtn">レイヤー追加</button>
              <button id="addVectorLayerBtn">ベクター追加</button>
              <button id="deleteLayerBtn">レイヤー削除</button>
            </div>
          </div>
        </div>

        <div class="toolbar-group" data-group="view" role="group" aria-label="表示">
          <div class="toolbar-group-label">表示</div>
          <div class="toolbar-group-body">
            <div class="toolbar-subgroup" role="group" aria-label="ビュー制御">
              <button id="fit">画面に合わせる</button>
              <button id="actual">100%</button>
            </div>

          </div>
        </div>

      <div id="headerResizer" class="header-resizer" role="separator" aria-orientation="horizontal"
        aria-label="ヘッダーの高さを調整">
      </div>

    </header>

    <main id="stage">
      <div id="leftPanel" class="side-panel panel" data-name="ツール">
        <section class="panel-section tool-selector-panel">
          <header class="panel-section-header">
            <h3 class="panel-section-title">ツール選択</h3>
          </header>
          <div class="tool-select-body" role="group" aria-label="ツール選択パネル">
            <button type="button" id="toolSearchTrigger" class="toolbar-command-button" data-action="show-tool-search"
              aria-haspopup="dialog" aria-controls="toolSearchOverlay" title="Ctrl+K">
              ツール検索 (Ctrl+K)
            </button>
            <div class="toolbar-inline-group" role="group" aria-label="基本ツール">
              <button class="tool" data-tool="select-rect" title="M">矩形選択</button>
              <button class="tool" data-tool="select-free">自由選択</button>
            </div>
            <details class="tool-dropdown" data-group="brushes" data-inline="true">
              <summary aria-haspopup="true">ブラシ系</summary>
              <div class="tool-dropdown-panel" role="menu">
                <div class="tool-section" aria-label="ブラシ">
                  <button class="tool" data-tool="pencil" title="P" role="menuitem">鉛筆</button>
                  <button class="tool" data-tool="pencil-click" title="Shift+P" role="menuitem">鉛筆(オフドラッグ)</button>
                  <button class="tool" data-tool="brush" title="B" role="menuitem">ブラシ</button>
                  <button class="tool" data-tool="minimal" role="menuitem">Minimal</button>
                  <button class="tool" data-tool="smooth" role="menuitem">Smooth</button>
                  <button class="tool" data-tool="texture-brush" role="menuitem">Texture</button>
                  <button class="tool" data-tool="tess-stroke" role="menuitem">テッセ</button>
                  <button class="tool" data-tool="sdf-stroke" role="menuitem">SDF</button>
                  <button class="tool" data-tool="watercolor" title="W" role="menuitem">水彩</button>
                  <button class="tool" data-tool="preview-refine" role="menuitem">二段</button>
                  <button class="tool" data-tool="vector-keep" title="K" role="menuitem">ベクタ</button>
                  <button class="tool" data-tool="calligraphy" title="C" role="menuitem">カリグラフィ</button>
                  <button class="tool" data-tool="ribbon" role="menuitem">リボン</button>
                  <button class="tool" data-tool="bristle" role="menuitem">多毛筆</button>
                  <button class="tool" data-tool="airbrush" role="menuitem">エアブラシ</button>
                  <button class="tool" data-tool="scatter" role="menuitem">散布</button>
                  <button class="tool" data-tool="smudge" role="menuitem">スマッジ</button>
                  <button class="tool" data-tool="aa-line-brush" role="menuitem">AA線</button>
                  <button class="tool" data-tool="pixel-brush" role="menuitem">ピクセル筆</button>
                  <button class="tool" data-tool="blur-brush" role="menuitem">ぼかし</button>
                  <button class="tool" data-tool="edge-aware-paint" role="menuitem">縁保持塗り</button>
                  <button class="tool" data-tool="noise-displaced" role="menuitem">ノイズ変位</button>
                  <button class="tool" data-tool="chalk-pastel" role="menuitem">Chalk</button>
                  <button class="tool" data-tool="curvature-adaptive" role="menuitem">Curvature</button>
                  <button class="tool" data-tool="depth-aware" role="menuitem">DepthAware</button>
                  <button class="tool" data-tool="distance-stamped" role="menuitem">Distance</button>
                </div>
              </div>
            </details>
            <details class="tool-dropdown" data-group="experimental" data-inline="true">
              <summary aria-haspopup="true">特殊/表現</summary>
              <div class="tool-dropdown-panel" role="menu">
                <div class="tool-section" aria-label="特殊ブラシ">
                  <button class="tool" data-tool="drip-gravity" role="menuitem">Drip</button>
                  <button class="tool" data-tool="flow-guided-brush" role="menuitem">Flow</button>
                  <button class="tool" data-tool="glyph-brush" role="menuitem">Glyph</button>
                  <button class="tool" data-tool="gpu-instanced-brush" role="menuitem">GPUStamp</button>
                  <button class="tool" data-tool="gradient-brush" role="menuitem">Gradient</button>
                  <button class="tool" data-tool="granulation" role="menuitem">Granulation</button>
                  <button class="tool" data-tool="halftone-dither" role="menuitem">Halftone</button>
                  <button class="tool" data-tool="hatching" role="menuitem">Hatching</button>
                  <button class="tool" data-tool="hdr-linear" role="menuitem">HDR</button>
                  <button class="tool" data-tool="height-normal" role="menuitem">HeightNorm</button>
                  <button class="tool" data-tool="mask-driven" role="menuitem">MaskDriven</button>
                  <button class="tool" data-tool="meta-brush" role="menuitem">Meta</button>
                  <button class="tool" data-tool="on-image-warp" role="menuitem">Warp</button>
                  <button class="tool" data-tool="outline-stroke-fill" role="menuitem">OutStroke</button>
                  <button class="tool" data-tool="palette-mapped" role="menuitem">PaletteMap</button>
                  <button class="tool" data-tool="pattern-art-brush" role="menuitem">PatternArt</button>
                  <button class="tool" data-tool="predictive-brush" role="menuitem">Predictive</button>
                  <button class="tool" data-tool="pvel-map" role="menuitem">PVMap</button>
                  <button class="tool" data-tool="snap-grid" role="menuitem">SnapGrid</button>
                  <button class="tool" data-tool="stamp-blend" role="menuitem">StampBlend</button>
                  <button class="tool" data-tool="stroke-boil" role="menuitem">StrokeBoil</button>
                  <button class="tool" data-tool="symmetry-mirror" role="menuitem">Symmetry</button>
                  <button class="tool" data-tool="time-aware" role="menuitem">TimeAware</button>
                </div>
              </div>
            </details>
            <details class="tool-dropdown" data-group="vector" data-inline="true">
              <summary aria-haspopup="true">幾何/ベクター</summary>
              <div class="tool-dropdown-panel" role="menu">
                <div class="tool-section" aria-label="幾何ツール">
                  <button class="tool" data-tool="line" title="L" role="menuitem">直線</button>
                  <button class="tool" data-tool="rect" title="R" role="menuitem">矩形</button>
                  <button class="tool" data-tool="ellipse" title="O" role="menuitem">楕円</button>
                  <button class="tool" data-tool="quad" title="Q" role="menuitem">2次ベジェ</button>
                  <button class="tool" data-tool="cubic" title="C" role="menuitem">3次ベジェ</button>
                  <button class="tool" data-tool="quad-edit" role="menuitem">2次ベジェ編集</button>
                  <button class="tool" data-tool="cubic-edit" role="menuitem">3次ベジェ編集</button>
                  <button class="tool" data-tool="arc" title="A" role="menuitem">円弧</button>
                  <button class="tool" data-tool="sector" title="S" role="menuitem">扇形</button>
                  <button class="tool" data-tool="catmull" title="U" role="menuitem">Catmull</button>
                  <button class="tool" data-tool="catmull-edit" role="menuitem">Catmull編集</button>
                  <button class="tool" data-tool="bspline" title="B" role="menuitem">Bスプライン</button>
                  <button class="tool" data-tool="bspline-edit" role="menuitem">Bスプライン編集</button>
                  <button class="tool" data-tool="nurbs" title="N" role="menuitem">NURBS</button>
                  <button class="tool" data-tool="nurbs-edit" role="menuitem">NURBS編集</button>
                  <button class="tool" data-tool="ellipse-2" title="E" role="menuitem">楕円(回転)</button>
                  <button class="tool" data-tool="freehand" title="H" role="menuitem">補間描画</button>
                  <button class="tool" data-tool="freehand-click" title="Shift+H" role="menuitem">補間描画(オフドラッグ)</button>
                </div>
                <div class="tool-section" aria-label="ベクター編集">
                  <button class="tool" data-tool="vectorization" title="V" role="menuitem">ベクタ化</button>
                  <button class="tool" data-tool="vector-edit" title="Shift+V" role="menuitem">ベクタ編集</button>
                </div>
              </div>
            </details>
            <details class="tool-dropdown" data-group="utility">
              <summary aria-haspopup="true">補助</summary>
              <div class="tool-dropdown-panel" role="menu">
                <div class="tool-section" aria-label="補助ツール">
                  <button class="tool" data-tool="eraser" title="E" role="menuitem">消しゴム</button>
                  <button class="tool" data-tool="eraser-click" title="Shift+E" role="menuitem">消しゴム(オフドラッグ)</button>
                  <button class="tool" data-tool="eyedropper" title="I" role="menuitem">スポイト</button>
                  <button class="tool" data-tool="bucket" title="F" role="menuitem">バケツ</button>
                  <button class="tool" data-tool="text" title="T" role="menuitem">テキスト</button>
                </div>
              </div>
            </details>
          </div>
        
        </section>

        <div
          id="toolPanelDivider"
          class="panel-divider"
          role="separator"
          aria-orientation="horizontal"
          aria-label="ツール選択とプロパティの境界を調整"
        ></div>
        
        <section class="panel-section tool-prop-panel">
          <header class="panel-section-header tool-prop-header">
            <div class="panel-section-title">ツールプロパティ</div>
          </header>
          <div class="panel-body">
            <div class="tool-prop-overview" aria-live="polite">
              <div class="tool-overview-row">
                <span class="tool-name-label">対象ツール:</span>
                <span id="activeToolLabel" class="tool-name">—</span>
              </div>
              <div id="activeToolUsage" class="tool-usage-note">操作方法はツール選択後に表示されます。</div>
            </div>
            <div class="tool-accordion">
              <details class="accordion-section" data-section="properties" open>
                <summary>プロパティ</summary>
                <div class="accordion-content">
                  <div id="toolPropContainer"></div>
                </div>
              </details>
              <details class="accordion-section" data-section="palette" open>
                <summary>パレット</summary>
                <div class="accordion-content">
                  <div id="toolPaletteContainer"></div>
                </div>
              </details>
              <details class="accordion-section" data-section="shortcuts">
                <summary>ショートカット</summary>
                <div class="accordion-content">
                  <div id="toolShortcutContainer"></div>
                </div>
              </details>
            </div>
          </div>
        </section>
      </div>

      <div id="leftResizer" class="panel-resizer"></div>

      <div id="canvasArea">
        <canvas id="base"></canvas>
        <canvas id="overlay"></canvas>
        <div id="editorLayer"></div>
      </div>


      <div id="rightResizer" class="panel-resizer"></div>

      <div id="layerPanel" class="side-panel panel" data-name="レイヤー">
        <section class="panel-section layer-selection-panel">
          <header class="panel-section-header">
            <h3 class="panel-section-title">レイヤー選択</h3>
          </header>
          <div class="panel-body">
            <div class="layer-controls">
              <div class="layer-filter-group" role="group" aria-label="レイヤー種別フィルター">
                <button type="button" class="layer-filter is-active" data-layer-filter="all">
                  すべて
                </button>
                <button type="button" class="layer-filter" data-layer-filter="raster">
                  ラスター
                </button>
                <button type="button" class="layer-filter" data-layer-filter="vector">
                  ベクター
                </button>
                <button type="button" class="layer-filter" data-layer-filter="text">
                  テキスト
                </button>
              </div>
              <label class="layer-search">
                <span class="visually-hidden">レイヤー名で検索</span>
                <input type="search" id="layerSearch" placeholder="名前で絞り込み" autocomplete="off" />
              </label>
            </div>
            <div class="layer-action-row">
              <button id="addLayerBtn">＋</button>
              <button id="addVectorLayerBtn" title="ベクターレイヤーを追加">＋V</button>
              <button id="delLayerBtn">－</button>
            </div>
            <ul id="layerList" class="layer-list"></ul>
          </div>
        </section>
        <section class="panel-section layer-props-panel">
          <header class="panel-section-header">
            <h3 class="panel-section-title">レイヤープロパティ</h3>
          </header>
          <div class="panel-body panel-body-static">
            <div id="layerProperties" class="layer-properties" style="display: none">
              <div class="layer-property-row">
                <span>種類:</span>
                <strong id="layerTypeLabel">—</strong>
              </div>
              <div id="vectorLayerControls" class="vector-layer-controls" style="display: none">
                <label for="vectorLayerColor">線色</label>
                <input type="color" id="vectorLayerColor" value="#000000" />
                <label for="vectorLayerWidth">線幅</label>
                <input type="number" id="vectorLayerWidth" min="0.1" step="0.1" value="1" />
                <label for="vectorLayerDash">破線</label>
                <input type="text" id="vectorLayerDash" placeholder="例: 4 2" />
                <label for="vectorLayerCap">線端</label>
                <select id="vectorLayerCap">
                  <option value="butt">butt</option>
                  <option value="round">round</option>
                  <option value="square">square</option>
                </select>
                <button id="vectorLayerApplyAll" type="button">全ベクターに適用</button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <footer class="row footer">
    <div id="status">準備完了</div>

    <div class="footer-right" role="group" aria-label="ステータス情報">
      <span id="autosaveBadge" class="footer-badge">AutoSave: —</span>
      <span class="footer-badge">ズーム: <span id="zoomPct">100%</span></span>
      <label class="layout-control" for="layoutPreset">
        <span class="layout-label">レイアウト:</span>
        <select id="layoutPreset" name="layoutPreset">
          <option value="default">標準</option>
          <option value="brush">ブラシ重視</option>
          <option value="reference">資料表示</option>
          <option value="focus">キャンバス集中</option>
          <option value="custom">カスタム</option>
        </select>
      </label>
      <span class="shortcut-hint">Space+ドラッグ=パン / Ctrl+ホイール=ズーム / 中ボタン=パン / Shift=拘束 /
        Esc=解除 / ?=ショートカット一覧</span>
      <button type="button" id="shortcutOverlayButton" class="footer-button" data-action="show-shortcut-overlay"
        aria-haspopup="dialog" aria-controls="shortcutOverlay">
        ショートカット一覧 (?)
      </button>
    </div>
  </footer>
  </div>

  <div id="toolDropdownLayer" aria-hidden="false"></div>

  <!-- 調整パネル（中身は前回と同じ） -->
  <div id="adjustPanel" role="dialog" aria-label="調整">
    <h3>調整（選択があれば選択範囲に適用）</h3>
    <div class="adjust-preview" aria-hidden="true">
      <canvas id="adjustPreviewBefore" width="140" height="100"></canvas>
      <canvas id="adjustPreviewAfter" width="140" height="100"></canvas>
    </div>
    <div class="row">
      <label>明るさ</label><input id="adjBrightness" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>コントラスト</label><input id="adjContrast" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>彩度</label><input id="adjSaturation" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>色相</label><input id="adjHue" type="range" min="-180" max="180" value="0" />
    </div>
    <div class="row">
      <label>反転</label><input id="adjInvert" type="checkbox" />
    </div>
    <div class="actions">
      <button id="adjReset">リセット</button>
      <button id="adjCancel">キャンセル</button>
      <button id="adjApply">適用</button>
    </div>
  </div>

  <div id="toolSearchOverlay" class="tool-search-overlay" role="dialog" aria-modal="true"
    aria-labelledby="toolSearchTitle" hidden>
    <div class="tool-search-panel" role="document">
      <header class="tool-search-header">
        <h2 id="toolSearchTitle">ツール検索</h2>
        <button type="button" class="tool-search-close" data-tool-search-dismiss aria-label="閉じる (Esc)" title="閉じる">
          ×
        </button>
      </header>
      <div class="tool-search-body">
        <label class="tool-search-label" for="toolSearchInput">ツール名やショートカットで検索</label>
        <input id="toolSearchInput" class="tool-search-input" type="search" placeholder="キーワードで検索 (Ctrl+K)"
          autocomplete="off" spellcheck="false" aria-controls="toolSearchResults" />
        <p class="tool-search-hint">Enterで決定、Escで閉じる、↑↓で移動</p>
        <ul id="toolSearchResults" class="tool-search-results" role="listbox" aria-label="検索結果"></ul>
        <p id="toolSearchEmpty" class="tool-search-empty" hidden>該当するツールがありません</p>
      </div>
    </div>
  </div>

  <div id="shortcutOverlay" class="shortcut-overlay" role="dialog" aria-modal="true"
    aria-labelledby="shortcutOverlayTitle" hidden>
    <div class="shortcut-overlay-panel" role="document">
      <header class="shortcut-overlay-header">
        <h2 id="shortcutOverlayTitle">ショートカット一覧</h2>
        <button type="button" class="shortcut-overlay-close" data-shortcut-dismiss aria-label="閉じる (Esc)" title="閉じる">
          ×
        </button>
        </section>
        <section class="shortcut-section">
          <h3>ツール切り替え</h3>
          <p class="shortcut-note">
            ツールボタンと同じショートカットキーを一覧表示しています。
          </p>
          <table class="shortcut-table">
            <thead>
              <tr>
                <th scope="col">ツール</th>
                <th scope="col">キー</th>
              </tr>
            </thead>
            <tbody id="shortcutToolTable"></tbody>
          </table>
        </section>
    </div>
  </div>
  </div>
  <script type="module" src="src/gui/panels.js"></script>
  <script type="module" src="src/gui/toolbar.js"></script>
  <script type="module" src="src/gui/tool-props.js"></script>
  <script type="module" src="src/main.js"></script>
</body>

</html>