<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Paint (UI fixed)</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="app">
    <header>
      <div id="systems" class="row">
        <button id="open">開く</button><input id="fileInput" type="file" accept="image/*" />
        <button id="savePNG">保存 PNG</button>
        <button id="saveJPG">保存 JPEG</button>
        <button id="saveWEBP">保存 WebP</button>
        <div class="sep"></div>
        <button id="adjustBtn">調整</button>
        <div class="sep"></div>
        <button id="fit">画面に合わせる</button>
        <button id="actual">100%</button>

        <div class="row" style="margin-left: auto; gap: 12px">
          <button id="restoreBtn" style="display: none">前回復元</button>
        </div>
        <div class="sep"></div>
        <button id="undo">Undo</button>
        <button id="redo">Redo</button>
        <button id="clear">全消去</button>
      </div>
      <div id="tools" class="row">
        <button class="tool" data-tool="select-rect" title="M">選択</button>
        <button id="copyBtn" title="Ctrl+C">コピー</button>
        <button id="cutBtn" title="Ctrl+X">カット</button>
        <button id="pasteBtn" title="Ctrl+V">ペースト</button>
        <div class="sep"></div>
        <button class="tool" data-tool="pencil" title="P">鉛筆</button>
        <button class="tool" data-tool="pencil-click" title="Shift+P">鉛筆(オフドラッグ)</button>
        <button class="tool" data-tool="brush" title="B">ブラシ</button>
        <button class="tool" data-tool="minimal">Minimal</button>
        <button class="tool" data-tool="smooth">Smooth</button>
        <button class="tool" data-tool="texture-brush">Texture</button>
        <button class="tool" data-tool="tess-stroke">テッセ</button>
        <button class="tool" data-tool="sdf-stroke">SDF</button>
        <button class="tool" data-tool="watercolor" title="W">水彩</button>
        <button class="tool" data-tool="preview-refine">二段</button>
        <button class="tool" data-tool="vector-keep" title="K">ベクタ</button>
        <button class="tool" data-tool="calligraphy" title="C">カリグラフィ</button>
        <button class="tool" data-tool="ribbon">リボン</button>
        <button class="tool" data-tool="bristle">多毛筆</button>
        <button class="tool" data-tool="airbrush">エアブラシ</button>
        <button class="tool" data-tool="scatter">散布</button>
        <button class="tool" data-tool="smudge">スマッジ</button>
        <button class="tool" data-tool="aa-line-brush">AA線</button>
        <button class="tool" data-tool="pixel-brush">ピクセル筆</button>
        <button class="tool" data-tool="blur-brush">ぼかし</button>
        <button class="tool" data-tool="edge-aware-paint">縁保持塗り</button>
        <button class="tool" data-tool="noise-displaced">ノイズ変位</button>
        <button class="tool" data-tool="chalk-pastel">Chalk</button>
        <button class="tool" data-tool="curvature-adaptive">Curvature</button>
        <button class="tool" data-tool="depth-aware">DepthAware</button>
        <button class="tool" data-tool="distance-stamped">Distance</button>
        <button class="tool" data-tool="drip-gravity">Drip</button>
        <button class="tool" data-tool="flow-guided-brush">Flow</button>
        <button class="tool" data-tool="glyph-brush">Glyph</button>
        <button class="tool" data-tool="gpu-instanced-brush">GPUStamp</button>
        <button class="tool" data-tool="gradient-brush">Gradient</button>
        <button class="tool" data-tool="granulation">Granulation</button>
        <button class="tool" data-tool="halftone-dither">Halftone</button>
        <button class="tool" data-tool="hatching">Hatching</button>
        <button class="tool" data-tool="hdr-linear">HDR</button>
        <button class="tool" data-tool="height-normal">HeightNorm</button>
        <button class="tool" data-tool="mask-driven">MaskDriven</button>
        <button class="tool" data-tool="meta-brush">Meta</button>
        <button class="tool" data-tool="on-image-warp">Warp</button>
        <button class="tool" data-tool="outline-stroke-fill">OutStroke</button>
        <button class="tool" data-tool="palette-mapped">PaletteMap</button>
        <button class="tool" data-tool="pattern-art-brush">PatternArt</button>
        <button class="tool" data-tool="predictive-brush">Predictive</button>
        <button class="tool" data-tool="pvel-map">PVMap</button>
        <button class="tool" data-tool="snap-grid">SnapGrid</button>
        <button class="tool" data-tool="stamp-blend">StampBlend</button>
        <button class="tool" data-tool="stroke-boil">StrokeBoil</button>
        <button class="tool" data-tool="symmetry-mirror">Symmetry</button>
        <button class="tool" data-tool="time-aware">TimeAware</button>
        <button class="tool" data-tool="vectorization">Vectorize</button>
        <button class="tool" data-tool="eraser" title="E">消しゴム</button>
        <button class="tool" data-tool="eraser-click" title="Shift+E">消しゴム(オフドラッグ)</button>
        <button class="tool" data-tool="eyedropper" title="I">スポイト</button>
        <button class="tool" data-tool="bucket" title="F">バケツ</button>
      </div>
      <div id="geotools" class="row">
        <button class="tool" data-tool="line" title="L">直線</button>
        <button class="tool" data-tool="rect" title="R">矩形</button>
        <button class="tool" data-tool="ellipse" title="O">楕円</button>
        <button class="tool" data-tool="quad" title="Q">2次ベジェ</button>
        <button class="tool" data-tool="cubic" title="C">3次ベジェ</button>
        <button class="tool" data-tool="arc" title="A">円弧</button>
        <button class="tool" data-tool="sector" title="S">扇形</button>
        <button class="tool" data-tool="catmull" title="U">Catmull</button>
        <button class="tool" data-tool="bspline" title="B">
          Bスプライン
        </button>
        <button class="tool" data-tool="nurbs" title="N">NURBS</button>
        <button class="tool" data-tool="ellipse-2" title="E">
          楕円(回転)
        </button>
        <button class="tool" data-tool="freehand" title="H">補間描画</button>
        <button class="tool" data-tool="freehand-click" title="Shift+H">補間描画(オフドラッグ)</button>
      </div>
      <div id="texttools" class="row">
        <button class="tool" data-tool="text" title="T">テキスト</button>
      </div>
    </header>

    <div id="stage">
      <div id="leftPanel" class="side-panel panel" data-name="ツール">
        <div class="panel-header"></div>
        <div class="panel-body"></div>
        <div class="panel-footer"></div>
      </div>

      <div id="leftResizer" class="panel-resizer"></div>

      <div id="mapPanel">
        <div id="mapControls" class="row">
          <div class="map-controls-group">
            <button id="mapZoomOut" type="button" aria-label="ズームアウト">－</button>
            <input
              id="mapZoomSlider"
              type="range"
              min="25"
              max="400"
              step="5"
              value="100"
              aria-label="ズーム倍率"
            />
            <span id="mapZoomValue" aria-live="polite">100%</span>
            <button id="mapZoomIn" type="button" aria-label="ズームイン">＋</button>
          </div>
          <div class="map-controls-group" role="radiogroup" aria-label="編集範囲">
            <label>
              <input type="radio" name="editScope" value="map" checked />マップ編集
            </label>
            <label>
              <input type="radio" name="editScope" value="cell" />セル編集
            </label>
          </div>
        </div>

        <div id="canvasArea">
          <canvas id="base"></canvas>
          <canvas id="overlay"></canvas>
          <div id="editorLayer"></div>
        </div>
      </div>

      <div id="rightResizer" class="panel-resizer"></div>

      <div id="layerPanel" class="side-panel panel" data-name="レイヤー">
        <div class="panel-header"></div>
        <div class="panel-body">
          <div style="display: flex; gap: 4px; align-items: center">
            <button id="addLayerBtn">＋</button>
            <button id="delLayerBtn">－</button>
          </div>
          <ul id="layerList"></ul>
        </div>
        <div class="panel-footer"></div>
      </div>
    </div>

    <footer class="row">
      <div id="status">準備完了</div>

      <div style="margin-left: auto">
        <span id="autosaveBadge" style="white-space: nowrap">AutoSave: —</span>
        ズーム: <span id="zoomPct">100%</span></span>
        Space+ドラッグ=パン / Ctrl+ホイール=ズーム / 中ボタン=パン /
        Shift=拘束 / Esc=解除
      </div>
    </footer>
  </div>

  <!-- 調整パネル（中身は前回と同じ） -->
  <div id="adjustPanel" role="dialog" aria-label="調整">
    <h3>調整（選択があれば選択範囲に適用）</h3>
    <div class="row">
      <label>明るさ</label><input id="adjBrightness" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>コントラスト</label><input id="adjContrast" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>彩度</label><input id="adjSaturation" type="range" min="-100" max="100" value="0" />
    </div>
    <div class="row">
      <label>色相</label><input id="adjHue" type="range" min="-180" max="180" value="0" />
    </div>
    <div class="row">
      <label>反転</label><input id="adjInvert" type="checkbox" />
    </div>
    <div class="actions">
      <button id="adjReset">リセット</button>
      <button id="adjCancel">キャンセル</button>
      <button id="adjApply">適用</button>
    </div>
  </div>
  <script type="module" src="src/gui/panels.js"></script>
  <script type="module" src="src/gui/toolbar.js"></script>
  <script type="module" src="src/gui/tool-props.js"></script>
  <script src="src/tools/select-rect.js"></script>
    <script src="src/tools/pencil.js"></script>
    <script src="src/tools/pencil-click.js"></script>
    <script src="src/tools/brush.js"></script>
    <script src="src/tools/minimal.js"></script>
    <script src="src/tools/smooth.js"></script>
    <script src="src/tools/texture-brush.js"></script>
    <script src="src/tools/tessellated-stroke.js"></script>
    <script src="src/tools/sdf-stroke.js"></script>
    <script src="src/tools/watercolor.js"></script>
    <script src="src/tools/preview-refine.js"></script>
    <script src="src/tools/vector-keep.js"></script>
    <script src="src/tools/calligraphy.js"></script>
    <script src="src/tools/ribbon.js"></script>
    <script src="src/tools/bristle.js"></script>
    <script src="src/tools/airbrush.js"></script>
    <script src="src/tools/scatter.js"></script>
    <script src="src/tools/smudge.js"></script>
    <script src="src/tools/aa_line_brush.js"></script>
    <script src="src/tools/pixel_brush.js"></script>
    <script src="src/tools/blur_brush.js"></script>
    <script src="src/tools/edge_aware_paint.js"></script>
    <script src="src/tools/noise-displaced.js"></script>
    <script src="src/tools/chalk_pastel.js"></script>
    <script src="src/tools/curvature_adaptive_brush.js"></script>
    <script src="src/tools/depth_aware_brush.js"></script>
    <script src="src/tools/distance_stamped_brush.js"></script>
    <script src="src/tools/drip_gravity_brush.js"></script>
    <script src="src/tools/flow_guided_brush.js"></script>
    <script src="src/tools/glyph_brush.js"></script>
    <script src="src/tools/gpu_instanced_stamps.js"></script>
    <script src="src/tools/gradient_brush.js"></script>
    <script src="src/tools/granulation_brush.js"></script>
    <script src="src/tools/halftone_dither_brush.js"></script>
    <script src="src/tools/hatching.js"></script>
    <script src="src/tools/hdr_linear_pipeline_brush.js"></script>
    <script src="src/tools/height_normal_aware_brush.js"></script>
    <script src="src/tools/mask_driven_brush.js"></script>
    <script src="src/tools/meta_brush.js"></script>
    <script src="src/tools/on_image_warp.js"></script>
    <script src="src/tools/outline_stroke_to_fill.js"></script>
    <script src="src/tools/palette_mapped_brush.js"></script>
    <script src="src/tools/pattern_art_brush.js"></script>
    <script src="src/tools/predictive_brush.js"></script>
    <script src="src/tools/pressure_velocity_map_brush.js"></script>
    <script src="src/tools/snap_grid_brush.js"></script>
    <script src="src/tools/stamp_blend_modes_brush.js"></script>
    <script src="src/tools/stroke_boil_brush.js"></script>
    <script src="src/tools/symmetry_mirror.js"></script>
    <script src="src/tools/time_aware_brush.js"></script>
    <script src="src/tools/vectorization_brush.js"></script>
    <script src="src/tools/eraser.js"></script>
    <script src="src/tools/eraser-click.js"></script>
  <script src="src/tools/quadratic.js"></script>
  <script src="src/tools/cubic.js"></script>
  <script src="src/tools/arc.js"></script>
  <script src="src/tools/sector.js"></script>
  <script src="src/tools/ellipse-2.js"></script>
  <script src="src/tools/freehand.js"></script>
  <script src="src/tools/freehand-click.js"></script>
  <script type="module" src="src/main.js"></script>
</body>

</html>