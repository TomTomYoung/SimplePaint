# ベクターツール実装進捗

## 完了

- 別のレイヤー抽象化に依存せずに、ベクターパス、ドラフトストローク、選択を所有し、描画インタラクション用のポインターハンドラを公開する `makeVectorTool` を実装しました。\
  _（完全な実装については `src/tools/vector/vector-tool.js` を参照してください。）_
- 既存のアンカーやグリッドへのスナッピングと、パスをコミットする前のオプションの Douglas–Peucker 簡略化を提供する座標処理ヘルパーを追加しました。
- プレビューレンダリング、アンカー視覚化、およびリクエスト時または自動モードでパスをラスターレイヤーにベイクするラスタライズヘルパーを実装しました。
- 共有ツールストアスライスを通じてベクターパスと設定を永続化し、セッションが以前の描画を再ハイドレートし、設定を維持するようにしました。
- ベクターツールをツールマニフェストに登録し、アプリケーション UI に表示されるようにしました。
- 新しいパスがコミットされたときの再ハイドレーションロジックと設定の永続化をカバーするユニットテストを追加しました。
- アンカーのヒットテストとドラッグ編集を追加し、新しいパスを作成せずに既存のポイントを再配置できるようにしました。ストアの永続化カバレッジも含みます。
- モディファイア駆動の編集ジェスチャを有効にしました：Shift/ダブルクリックで既存のセグメントに新しいアンカーを挿入し、Alt+クリックでアンカーを削除するか、空になった場合はパスを削除します。対応する永続化テストも含みます。
- スナッピング動作を維持しながら形状全体を再配置できるように、セグメントをドラッグしてパスを直接移動する機能を追加しました。ユニットカバレッジも含みます。
- スナッピング設定、簡略化許容値、ラスタライズモード、アンカー表示の UI コントロールを公開し、アーティストがツールパネルを離れずに動作を調整できるようにしました。

## 進行中 / TODO

- 編集ツールには、専用のセグメント分割 UI アフォーダンス、マルチポイント選択、およびアンカー再配置以外のストロークスタイル調整がまだ不足しています。
- ラスタライズスナップショット以外のベクター編集の Undo/Redo 統合はまだ検証が必要です。
- SVG エクスポートは現在シンプルな `M/L` パスコマンドを出力します。曲線と形状プリミティブのサポートは保留中です。

## 次のステップ

1. ツール所有モデル内でアンカー編集インタラクションを設計・実装します。
2. プリセット、インラインドキュメント、依存フィールドのコンテキストに応じた無効化を含む設定 UI を反復します。
3. ベジェ曲線、矩形、楕円、ポリゴンの編集フローが完成したら、それらをカバーするようにエクスポートとラスタライズルーチンを拡張します。
4. メインアプリケーションエンジンでツールライフサイクルを実行する統合テストを追加します。
