# プロジェクト進捗レポート

## アプリケーションの起動フロー
- `index.html` に UI 全体（ツールバー、キャンバス領域、サイドパネル、フッター）が定義されており、初期状態から複数の描画ツールやレイヤー操作ボタンが利用可能です。
- `src/main.js` で `PaintApp` を生成し、塗りつぶしやテキスト編集といったユーティリティをエクスポートしています。ロードイベントで `app.boot()` を呼び出し、アプリの初期化を開始します。
- `src/app.js` の `PaintApp` クラスは DOM マネージャー、イベントバス、ストア、ビューポート、描画エンジンを構築し、ツール登録と UI 初期化、ドキュメント生成を担当しています。

## コアシステム
- `src/core/engine.js` の `Engine` クラスはツール登録・切り替え、ヒストリースタック管理、選択範囲の蟻の行進描画、フィルタープレビュー、キャンバスのリサイズと描画などを一手に担います。
- ビューポート (`src/core/viewport.js`) はパン・ズーム情報を保持し、描画エンジンと UI のズーム表示を同期します。
- ストア (`src/core/store.js`) はツールごとの状態とグローバル設定を集中管理し、イベントバスを通じた更新通知を提供します。

## ツールエコシステム
- `src/tools/registry.js` で選択ツール、ブラシ系、水彩、ノイズ、ベクター処理、幾何ツール、テキストなど多数のツールファクトリを登録しています。
- 各ツールはストアを介して設定を取得し、エンジン API に沿った共通インターフェースで動作するため、追加や差し替えが容易な構造です。

## 入出力・セッション管理
- `src/io/index.js` はファイル読込、画像書き出し、クリップボード操作、オートセーブ（セッション保存・復元）を集約しており、状態更新時にステータスバーやボタン表示を制御します。
- ペーストイベントをハンドリングし、画像を取得して浮動選択としてキャンバスへ配置する処理や、保存失敗時のメッセージ表示など、ユーザー体験に必要な分岐が実装済みです。

## UI 全般
- 左右のサイドパネルやリサイズハンドル、ステータスバー表示、ショートカット案内など、ユーザーフィードバックを高める仕組みが `index.html` と対応する GUI モジュールで実装されています。
- `styles.css` はフレックスレイアウトでステージやパネルの配置を定義し、キャンバス領域の自動リサイズとエディターレイヤーの重ね合わせに対応しています。

## 次のステップ候補
- ツールごとの設定 UI や内部状態を `docs/` 配下にまとめ、開発者ガイドを整備すると保守性が高まります。
- `test/` ディレクトリを活用し、主要ユーティリティ（塗りつぶし、幾何計算など）の自動テストを拡充することで回帰不具合を防げます。
- オートセーブやクリップボード処理のエラーハンドリングを GUI 上で通知するためのデザイン調整も検討できます。

## 最新アップデート
- 数値ユーティリティに角度変換や循環、スムースステップ関数を追加し、描画アルゴリズムで扱う補間計算が扱いやすくなりました。
- 幾何ユーティリティに折れ線長、面積、重心計算を実装し、図形ツールの開発に必要な計算が揃いました。
- 新規テストとして数学・幾何モジュールを検証するスイートを追加し、ユーティリティ層の信頼性を高めています。
- 幾何ユーティリティに線分交差・最短距離・点内包判定を追加し、選択範囲操作やスナップ機能のロジック構築が進めやすくなりました。
- テストスイートも拡張し、新規ジオメトリ関数の境界ケースを含めて自動検証できるようにしています。
